<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="AcidStat">
	
	<typeAlias  alias="paramMap" type="java.util.Map"/>
	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	
	<select id="AcidStatDAO.selectAcidStatMonList" parameterClass="paramMap" resultClass="egovMap">
		/* AcidStatDAO.selectAcidStatList */
		SELECT TRN,
		       SUM(DECODE(SMON,'01',ACNT,'')) AS M01, SUM(DECODE(SMON,'02',ACNT,'')) AS M02,
		       SUM(DECODE(SMON,'03',ACNT,'')) AS M03, SUM(DECODE(SMON,'04',ACNT,'')) AS M04,
		       SUM(DECODE(SMON,'05',ACNT,'')) AS M05, SUM(DECODE(SMON,'06',ACNT,'')) AS M06,
		       SUM(DECODE(SMON,'07',ACNT,'')) AS M07, SUM(DECODE(SMON,'08',ACNT,'')) AS M08,
		       SUM(DECODE(SMON,'09',ACNT,'')) AS M09, SUM(DECODE(SMON,'10',ACNT,'')) AS M10,
		       SUM(DECODE(SMON,'11',ACNT,'')) AS M11, SUM(DECODE(SMON,'12',ACNT,'')) AS M12,
		       SUM(ACNT) AS TOT
		  FROM (
		        SELECT FN_GET_CD_NM_BY_TBL(#sTable#, $sColumn$) AS TRN, SUBSTR(STND_MON,1,4) AS SYEAR, SUBSTR(STND_MON,5,2) AS SMON, ACC_CNT AS ACNT
		          FROM $sTable$
		         WHERE 1=1
		<isNotEmpty property="sKeyword">
				   AND FN_GET_CD_NM_BY_TBL(#sTable#, $sColumn$) LIKE '%'||#sKeyword#||'%'
		</isNotEmpty>
				   AND STND_MON LIKE #sDate#||'%'		           
		       ) X
		 GROUP BY TRN
		 ORDER BY TRN 
	</select>
	
	<select id="AcidStatDAO.selectAcidStatMonListChart" parameterClass="paramMap" resultClass="egovMap">
		/* AcidStatDAO.selectAcidStatMonListChart */
        SELECT FN_GET_CD_NM_BY_TBL(#sTable#, $sColumn$) AS TRN, TO_CHAR(TO_DATE(STND_MON,'YYYYMM'),'MM')||'월' AS STERM, ACC_CNT AS ACNT
          FROM $sTable$
         WHERE 1=1
		<isNotEmpty property="sKeyword">
		   AND FN_GET_CD_NM_BY_TBL(#sTable#, $sColumn$) LIKE '%'||#sKeyword#||'%'
		</isNotEmpty>
		   AND STND_MON LIKE #sDate#||'%' 
		 ORDER BY STERM, TRN
	</select>
	
	<select id="AcidStatDAO.selectAcidStatYearList" parameterClass="paramMap" resultClass="egovMap" remapResults="true">
		/* AcidStatDAO.selectAcidStatYearList */
		WITH PV AS (
		SELECT FN_GET_CD_NM_BY_TBL(#sTable#, $sColumn$) AS TRN, NVL(STND_YEAR,-1) AS SYEAR, SUM(ACC_CNT) AS ACNT
		  FROM $sTable$
		 WHERE 1=1
		<isNotEmpty property="sKeyword">
		   AND FN_GET_CD_NM_BY_TBL(#sTable#, $sColumn$) LIKE '%'||#sKeyword#||'%'
		</isNotEmpty>		
		   AND STND_YEAR BETWEEN $sDate$ AND $eDate$    
		 GROUP BY CUBE($sColumn$, STND_YEAR)	        
		)
		SELECT *
		  FROM PV
		 PIVOT (SUM(ACNT) FOR SYEAR IN ($yearArr$, -1 AS TOT))
		 WHERE TRN IS NOT NULL
		 ORDER BY TRN		 
	</select>	
	
	<select id="AcidStatDAO.selectAcidStatYearListChart" parameterClass="paramMap" resultClass="egovMap">
		/* AcidStatDAO.selectAcidStatYearListChart */
		SELECT FN_GET_CD_NM_BY_TBL(#sTable#, $sColumn$) AS TRN, STND_YEAR||'년' AS STERM, ACC_CNT AS ACNT
		  FROM $sTable$
		 WHERE 1=1
		<isNotEmpty property="sKeyword">
		   AND FN_GET_CD_NM_BY_TBL(#sTable#, $sColumn$) LIKE '%'||#sKeyword#||'%'
		</isNotEmpty>		
		   AND STND_YEAR BETWEEN $sDate$ AND $eDate$
		 ORDER BY STERM, TRN
	</select>
		
</sqlMap>
